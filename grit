#!/bin/bash

# Reset
Color_Off='\033[0m'       # Text Reset

# Regular Colors
Red='\033[0;31m'          # Red
Green='\033[0;32m'        # Green
Yellow='\033[0;33m'       # Yellow
Blue='\033[0;34m'         # Blue
Purple='\033[0;35m'       # Purple
Cyan='\033[0;36m'         # Cyan

if [ "$1" == "pull" ]; then
    if [ -z "$2" ]; then
        git pull origin develop --no-edit
    else
        git pull origin $2 --no-edit
    fi
elif [ "$1" == "push" ]; then
    if [ -z "$2" ]; then
        git push origin HEAD
    else
        git push origin $2
    fi
elif [ "$1" == "force" ]; then
    read -p "What's the magic word? " password
    if [ "$password" == "please" ]; then
        if [ -z "$2" ]; then
            git push origin HEAD --force
        else
            git push origin $2 --force
        fi
    # Cast a spell
    elif [ "$password" == "avada kedavra" ]; then
        echo -e "-${Green}~~~*${Color_Off}"
    # Give some treasure
    elif [ "$password" == "open sesame" ]; then
        echo -e "${Yellow}o${Color_Off}"
    else
        echo "Ah ah ah, you didn't say the magic word!"
    fi
elif [ "$1" == "update" ]; then
    git pull origin master
elif [ "$1" == "diff" ]; then
    if [ -z "$2" ]; then
        git diff -w --ignore-blank-lines
    else
        git diff -w --ignore-blank-lines $2
    fi
elif [ "$1" == "commit" ]; then
    if [ -z "$2" ]; then
        git commit
    else
        git commit -m "$2"
    fi
elif [ "$1" == "cad" ]; then
    git add $2
    if [ -z "$3" ]; then
        git commit
    else
        git commit -m "$3"
    fi
elif [ "$1" == "uncommit" ]; then
    git reset --soft HEAD^
elif [ "$1" == "amend" ]; then
    git commit --amend --no-edit
elif [ "$1" == "sup" ]; then
    git submodule foreach git pull origin master
elif [ "$1" == "sut" ]; then
    git submodule foreach 'git fetch origin; git checkout $(git describe --tags `git rev-list --tags --max-count=1`);'
elif [ "$1" == "suc" ]; then
    git submodule foreach $2
elif [ "$1" == "-h" ]; then
    echo "readable git"
    echo "=== COMMANDS ========="
    echo "grit                      list current branches and current modified files"
    echo "grit pull [branch]        pull branch (or develop of none provided)"
    echo "grit push [branch]        push to branch (or HEAD if non provided)"
    echo "grit force [branch]       push to branch (or HEAD) if asked nicely"
    echo "grit update               pull master branch"
    echo "grit diff                 show diff, ignoring whitespace changes"
    echo "grit commit [message]     commit staged files with message (opens editor if none provided)"
    echo "grit cad [path] [message] add path and commit with message (opens editor if none provided)"
    echo "grit uncommit             un-commit the last commit without losing work"
    echo "grit amend                amend the staged files to the last commit"
    echo "grit sup                  for each submodule pull the latest master branch"
    echo "grit sut                  for each submodule pull the latest tag"
    echo "grit suc                  for each submodule run a command"
elif [ -z "$1" ]; then
    git branch
    if [[ $(git diff --stat --cached) ]]; then
        echo -e "${Green}Staged files:${Color_Off}"
        git diff --stat=$COLUMNS --cached --color | sed \$d
    fi
    if [[ $(git diff --stat) ]]; then
        echo -e "${Red}Not staged files:${Color_Off}"
        git diff --stat=$COLUMNS --color | sed \$d
    fi
    if [[ $(git ls-files --others --exclude-standard) ]]; then
        echo -e "${Blue}Untracked files:${Color_Off}"
        git ls-files --others --exclude-standard | sed  's/^/ /'
    fi
else
    git $@
fi
